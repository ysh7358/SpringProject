<!--황지수-->
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>보육원 | 검색</title>
    <!--    <link rel="stylesheet" type="text/css"-->
    <!--          href="//p25.zdassets.com/hc/theming_assets/9204604/360002309011/style.css?digest=12256508972825">-->
</head>
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1"/>

<link rel="stylesheet" href="/css/fix/header.css">
<link rel="stylesheet" href="/css/fix/footer.css">
<link rel="stylesheet" href="/css/school/schoolList.css">
<link rel="stylesheet" href="/css/fix/menu.css">
<link rel="icon" href="/imgs/fix/favicon.png">

<body>
<header th:replace="/fix/header.html :: header"></header>

</th:block>
<div class="wholePage">
    <!-- 배너섹션 -->
    <section class="topBanner">
        <div id="banner">
            <div id="banner2">
                <h1 id="text">
                    기부하고 싶은
                    <br>
                    <span>보육원 알아보기</span>
                </h1>
            </div>
        </div>
    </section>

    <!-- 지역섹션 -->
    <form th:action="@{/school/list}" name="searchForm" onsubmit="return false">
        <section class="loc centerContent">
            <div class="loactions" style="padding-top: 65px; display: flex;height: 150px;">
                <div class="selectedAddress"></div>
                <div class="location wholeLocation">전체</div>
                <div class="location location2">서울</div>
                <div class="location location2">인천</div>
                <div class="location location2">경기도</div>
                <div class="location location2">강원도</div>
                <div class="location location2">충청도</div>
                <div class="location location2">전라도</div>
                <div class="location location2">경상도</div>
                <div class="location location2">제주도</div>
            </div>

            <div class="tAndS totalCount searchBox">
                <!-- 이전 선택한 지역-->
                <div class="beforeSelectLocations" style="display: none">
                </div>
                <!-- 총 검색 개수 -->
                <div class="totalCount">총 &nbsp;
                    <span id="totalCountNumber" th:text="${totalSchool}"></span>건
                </div>
                <!-- 검색창 -->
                <div class="searchBox realSearhBox">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"
                         focusable="false" preserveAspectRatio="xMidYMid meet" class="css-7kp13n e181xm9y0">
                        <path xmlns="http://www.w3.org/2000/svg"
                              d="M11.2307008,3.5 C15.5002489,3.5 18.9614015,6.96828437 18.9614015,11.24663 C18.9614015,13.0978372 18.3133954,14.7973826 17.2322825,16.1299241 L20.2742127,19.178378 C20.5762688,19.4810023 20.5764739,19.9714482 20.2746708,20.2738195 C19.9728678,20.5761908 19.4833433,20.5759857 19.1812873,20.2733614 L19.1812873,20.2733614 L16.1426973,17.2288066 C14.8071694,18.3312107 13.0960911,18.9932599 11.2307008,18.9932599 C6.96115262,18.9932599 3.5,15.5249756 3.5,11.24663 C3.5,6.96828437 6.96115262,3.5 11.2307008,3.5 Z M11.2307008,5.04932599 C7.81506225,5.04932599 5.04614015,7.82395349 5.04614015,11.24663 C5.04614015,14.6693064 7.81506225,17.4439339 11.2307008,17.4439339 C14.6463393,17.4439339 17.4152614,14.6693064 17.4152614,11.24663 C17.4152614,7.82395349 14.6463393,5.04932599 11.2307008,5.04932599 Z">
                        </path>
                    </svg>
                    <input type="hidden" class="schoolName" name="schoolName">
                    <input type="text" class="schoolName" id="schoolName" placeholder=" &nbsp;보육원을 검색하세요" value=""
                           style="border: solid white;">
                </div>
            </div>


            <!-- ==================반응형================ -->
            <!-- 드롭다운 -->
            <div class="dropdown" style="justify-content: flex-end; position: relative;">
                <button class="dropbtn">
                    <span class="dropbtn_content placeholder">전체</span>
                    <span class="dropbtn_click" style=" font-size : 16px; color : #3b3b3b; float:right;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"
                         focusable="false" preserveAspectRatio="xMidYMid meet" class="css-7kp13n e181xm9y0"><polygon
                            id="Triangle"
                            transform="translate(12.000000, 12.000000) rotate(-180.000000) translate(-12.000000, -12.000000) "
                            points="12 9 18 15 6 15"></polygon></svg>
                </span>
                </button>
                <div class="dropdown-content" style="position: absolute;">
                    <div class="dropLoc checkSeoul">서울</div>
                    <div class="dropLoc checkKyungki">경기도</div>
                    <div class="dropLoc checkKangwon">강원도</div>
                    <div class="dropLoc checkChungcheong">충청도</div>
                    <div class="dropLoc checkJeolla">전라도</div>
                    <div class="dropLoc checkGyeong">경상도</div>
                    <div class="dropLoc checkJeju">제주도</div>
                </div>
            </div>
            <!-- ====================================== -->
        </section>
    </form>
    <!-- 목록섹션 -->
    <section class="schoolList centerContent">
        <div class="noneSearchWrap">
            <div class="noneSearch">
                <div></div>
                <div>&nbsp;에 대한 검색 결과가 없습니다.</div>
            </div>
        </div>
        <div class = "schoolListItem"></div>
    </section>

    <!--페이지 버튼-->
    <div class="paging-number-box">
        <div class="paging-number">
            <div class="paging-number-flex">
            </div>
        </div>
    </div>
</div>

<footer th:replace="/fix/footer.html :: footer"></footer>

</body>
<script src="https://code.jquery.com/jquery-3.6.1.min.js"></script>
<script type="text/javascript" src="/js/school/schoolList.js"></script>
<script src="/js/fix/header.js"></script>
<script th:inline="javascript">
    globalThis.page = 0;
    const $location2 = $(".location2");
    const $wholeLocation = $(".wholeLocation");
    const $location = $(".location");
    let sessionId = [[${userId}]];
    let sessionType = [[${session.type}]];

    // 메인화면에서 검색을 했을 경우 검색값 저장
    let searchFromMain = [[${search.schoolName}]];

    // 메인화면에서 검색한 값을 검색창에 띄움
    if (searchFromMain) {
        $('.schoolName').val(searchFromMain);
    }

    // 처음 목록 가져오기
    show();

    //이전 페이지 감지
    window.onpageshow = function (e) {
        if (e.persisted) {
            setTimeout(() => getLikeSchoolList1(clickLikeBtn), 100)
        }
    }

    //지역으로 검색
    $location.on('click', function () {
        globalThis.page = 0;
        search()
    })

    //보육원 이름으로 검색
    $schoolName.on('keyup', function (e) {
        if (e.keyCode == 13) {
            $('input[name = "schoolName"]').val($schoolName.val());
            searchFromMain = $schoolName.val();
            globalThis.page = 0;
            search()
        }
    })

    //==========================페이징============================

    let pageInfo;

    // DB에서 조회된 보육원의 정보들을 화면에 쏴줌
    function getList(schoolDTO) {
        let text = "";
        console.log(schoolDTO)

        console.log(schoolDTO.content.length)

        pageInfo = schoolDTO;
        schoolDTO.content.forEach(school => {
            console.log(school.files)
            console.log(school.files[0])
            text += `<article>`
            text += `<span class="schoolImg">`
            if(school.files.length == 0){
                text += `<img width="214px" height="214px" src="/imgs/school/defaultSchoolImg.png">`
            }else{
                text += `<img width="214px" height="214px" src= "/file/display?fileName=`+ school.files[0].filePath + `/` + school.files[0].fileUuid + `_` + school.files[0].fileName +`">`
            }
            if (sessionType == "people") {
                text += `<span class="heartWrap">`
                text += `<span role="img" color="#ffffff" rotate="0" class="heart emptyHeart">`
                text += `<svg width="26" height="26" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"`
                text += `focusable="false" preserveAspectRatio="xMidYMid meet" class="css-7kp13n e181xm9y0">`
                text += `<defs>`
                text += `<path d="M16.3680447,3 C14.8701244,3 13.434867,3.60809471 12.3788995,4.68835248 L11.999764,5.07602721 L11.6205012,4.68822239 C9.41974855,2.43790277 5.843218,2.4379028 3.64246538,4.68822244 C1.45251156,6.92750008 1.45251154,10.5501072 3.64246532,12.7893849 L11.4435969,20.7662195 C11.7484384,21.0779268 12.2510896,21.0779268 12.555931,20.7662195 L20.3570626,12.7893849 C21.4096395,11.7136062 22,10.2567327 22,8.73880364 C22,7.22093571 21.409687,5.76411845 20.3570626,4.68822238 C19.3011071,3.60804588 17.8659048,3 16.3680447,3 Z M11.999764,19.1166999 L4.75479942,11.7085588 C3.15293092,10.0706117 3.15293094,7.4069956 4.75479947,5.76904857 C6.34586921,4.14214354 8.91709737,4.14214352 10.5081671,5.76904852 L11.4435969,6.72554678 C11.7484384,7.0372541 12.2510896,7.0372541 12.555931,6.72554678 L13.4913608,5.76904851 C14.2561214,4.98669624 15.2906419,4.5483871 16.3680447,4.5483871 C17.4454474,4.5483871 18.4799679,4.98669624 19.2446013,5.76891842 C20.0136074,6.55487573 20.4466019,7.6234063 20.4466019,8.73880364 C20.4466019,9.85420097 20.0136074,10.9227315 19.2448557,11.7084287 L18.3092987,12.665057 L11.999764,19.1166999 Z"`
                text += `id="heart-outlined-fill-icon"></path>`
                text += `</defs>`
                text += `<g id="Icons_Favorite_border_fill" stroke="none" stroke-width="1" fill-rule="evenodd">`
                text += `<path d="M16.3680447,3 C14.8701244,3 13.434867,3.60809471 12.3788995,4.68835248 L11.999764,5.07602721 L11.6205012,4.68822239 C9.41974855,2.43790277 5.843218,2.4379028 3.64246538,4.68822244 C1.45251156,6.92750008 1.45251154,10.5501072 3.64246532,12.7893849 L11.4435969,20.7662195 C11.7484384,21.0779268 12.2510896,21.0779268 12.555931,20.7662195 L20.3570626,12.7893849 C21.4096395,11.7136062 22,10.2567327 22,8.73880364 C22,7.22093571 21.409687,5.76411845 20.3570626,4.68822238 C19.3011071,3.60804588 17.8659048,3 16.3680447,3 Z"`
                text += `id="Shape" fill="#212224" fill-rule="nonzero" opacity="0.2"></path>`
                text += `<mask id="mask-2" fill="white">`
                text += `<use xlink:href="#heart-outlined-fill-icon"></use>`
                text += `</mask>`
                text += `<use id="Shape" xlink:href="#heart-outlined-fill-icon"></use>`
                text += `</g>`
                text += `</svg>`
                text += `</span>`
                text += `<span role="img" color="#ff7262" rotate="0" class="heart redHeart">`
                text += `<svg width="26" height="26" viewBox="0 0 24 24" fill="#ff7262" aria-hidden="true"`
                text += `focusable="false" preserveAspectRatio="xMidYMid meet" class="css-7kp13n e181xm9y0">`
                text += `<path xmlns="http://www.w3.org/2000/svg"`
                text += `d="M16.3680447,3 C14.8701244,3 13.434867,3.60809471 12.3788995,4.68835248 L11.999764,5.07602721 L11.6205012,4.68822239 C9.41974855,2.43790277 5.843218,2.4379028 3.64246538,4.68822244 C1.45251156,6.92750008 1.45251154,10.5501072 3.64246532,12.7893849 L11.4435969,20.7662195 C11.7484384,21.0779268 12.2510896,21.0779268 12.555931,20.7662195 L20.3570626,12.7893849 C21.4096395,11.7136062 22,10.2567327 22,8.73880364 C22,7.22093571 21.409687,5.76411845 20.3570626,4.68822238 C19.3011071,3.60804588 17.8659048,3 16.3680447,3 Z"></path>`
                text += `</svg>`
                text += `</span>`
                text += `</span>`
            }
            text += `</span>`
            text += `<span class="schoolIntroduce">`
            text += `<h2 class="schoolName">` + school.schoolName + `</h2>`
            text += `<div class="intro">` + school.schoolContent + `</div>`
            text += `<div class="miniLocationTag">`
            text += `<div class="schoolLocation1">`
            text += `<span class="schoolLocation2">` + school.schoolAddress + `</span>`
            text += `<span class="schoolLocation2 schoolName">` + school.schoolName + `</span>`
            text += `</div>`
            text += `</div>`
            text += `</span>`
            text += `<div class="rightBox">`
            text += `<div class="QR">`
            text += `<img src="`+school.schoolQR + `">`
            text += `</div>`
            text += `<a class="donationButton" href = "` + school.userId + `"><span>보육원 보러가기</span></a>`
            text += `</div>`
            text += `</article>`
        })

        if (schoolDTO.content.length == 0) {
            $('.noneSearch').children().first().text("'" + searchFromMain + "'")
            $('.noneSearchWrap').show()
            $(".schoolListItem").html(text)
            $pagingBtnFlex.html(text);
        } else {
            $('.noneSearchWrap').hide()
            $(".schoolListItem").html(text)
            $(".redHeart").css({"display": "none"})
            pageingBtn();
            getLikeSchoolList1(clickLikeBtn);
        }

        $("#totalCountNumber").html(schoolDTO.totalElements)
    }

    // 지역검색또는 보육원 이름으로 검색
    function search() {
        getList1({
            schoolAddress: save,
            schoolName: $('input[name = "schoolName"]').val(),
            page: globalThis.page
        }, getList);
    }

    // 보육원 목록
    function show() {
        getList1({
            schoolAddress: save,
            schoolName: [[${search.schoolName}]],
            page: globalThis.page
        }, getList)
    }


    //-----------------------------페이징 버튼 처리-----------------------------
    let $pagingBtnFlex = $('.paging-number-flex');

    function pageingBtn() {
        let text = "";
        let nowPage = pageInfo.pageable.pageNumber + 1;
        let endPage = Math.ceil(nowPage / 5) * 5;
        let startPage = endPage - 5 + 1;
        // <!--페이징 처리-->
        // 이전
        if (startPage > 1) {
            text += `<div class="prev-page page-number-padding">`
            text += `<a class="page-number-link" href="` + (startPage - 2) + `">`
            text += `<div class="prev-page-prevArrow"></div>`
            text += `</a>`
            text += `</div>`
        } else {
            text += `<div class="prev-page page-number-padding">`
            text += `</div>`
        }
        // 페이지 버튼

        for (let i = startPage; i < startPage + 5 && i <= pageInfo.totalPages; i++) {
            text += `<div class="page-number-padding">`
            if (i == nowPage) {
                text += `<div class="page-number-link" style="color:#303441">` + i + `</div>`
            } else {
                text += `<a class="page-number-link" href="` + (i - 1) + `">` + i + `</a>`
            }
            text += `</div>`
        }
        //이후
        if (4 < endPage && endPage < pageInfo.totalPages) {
            text += `<div class="next-page page-number-padding">`
            text += `<a class="page-number-link" href="` + (endPage) + `">`
            text += `<div class="prev-page-nextArrow"></div>`
            text += `</a>`
            text += `</div>`
            text += `</div>`
            text += `</div>`
        }

        $pagingBtnFlex.html(text);
    }

    // 버튼 클릭시 화면 상단으로 이동
    $pagingBtnFlex.on('click', ".page-number-link", function (e) {
        e.preventDefault();
        window.scrollTo({top: 0})
        globalThis.page = $(this).attr("href");
        search();
    })

    /*  페이지 이동  */
    const $pageNumberLink = $('.page-number-link');

    $pagingBtnFlex.on('mouseover', "a.page-number-link", function () {
        $(this).css('background-color', '#f4f6fa');
        // $(this).css('color', '#009ef7');
    })

    // 버튼 디자인
    $pagingBtnFlex.on('mouseout', "a.page-number-link", function () {
        $(this).css('background-color', '#fff');
        $(this).css('color', '#9a9ba7');
    })

    // window.onresize = function () {
    //     document.location.reload();
    // };

    //    보육원 상세 이동
    $(".schoolList").on('click', '.donationButton', function (e) {
        e.preventDefault();
        location.href = "/school/read?userId=" + $(this).attr("href");
    })

    //=======================좋아요======================
    //내가 좋아한 보육원 빈하트 채우기
    function clickLikeBtn(likeSchoolList) {
        $('.donationButton').each(function () {
            let likeFlag;
            let $donationButton = $(this);
            let schoolId = $donationButton.attr("href");
            likeSchoolList.forEach(function (likeId) {
                if (schoolId == likeId) {
                    $donationButton.closest('article').find(".redHeart").css({"display": "inline"})
                    $donationButton.closest('article').find(".emptyHeart").css({"display": "none"})
                    likeFlag = true;
                    return
                }
            });
            if (!likeFlag) {
                $donationButton.closest('article').find(".redHeart").css({"display": "none"})
                $donationButton.closest('article').find(".emptyHeart").css({"display": "inline"})
            }
        })
    }

    //

</script>
</html>